<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <title>BlazorWebAssemblyCustomEvents</title>
    <base href="/" />
    <link href="css/app.css" rel="stylesheet" />
    
    <!-- If you add any scoped CSS files, uncomment the following to load them
    <link href="BlazorWebAssemblyCustomEvents.styles.css" rel="stylesheet" /> -->
</head>

<body>
    <div id="app">Loading...</div>

    <div id="blazor-error-ui">
        An unhandled error has occurred.
        <a href="" class="reload">Reload</a>
        <a class="dismiss">ðŸ—™</a>
    </div>
    <script src="_framework/blazor.webassembly.js"></script>
    <script>
        const inputFileToBase64 = file => new Promise((resolve, reject) => {
            const reader = new FileReader()
            reader.readAsDataURL(file)

            reader.onload = () => resolve(reader.result)
            reader.onerror = error => reject(error)
        })

        const getBase64Files = async (items) => {
            const base64Files = []

            for (const item of items) {
                const base64 = await inputFileToBase64(item.getAsFile())

                base64Files.push(base64)
            }

            return base64Files
        }

        //const items = event.clipboardData.items
        //const files = await getBase64Files(items)

        Blazor.registerCustomEventType('filechange', {
            browserEventName: 'change',
            createEventArgs: event => {
                // This example only deals with pasting text, but you could use arbitrary JavaScript APIs
                // to deal with users pasting other types of data, such as images
                //const items = event.clipboardData.items
                //const files = await getBase64Files(items)
                //return event;
                let myString;
                const fileText = event.target.files[0].text().then((str) => { return str; });
                const text = () => {
                    fileText.then((a) => {
                        //myString = a;
                        console.log(a)
                        return a;
                    });
                };
                //const text = async () => {
                //    const a = await fileText;
                //    console.log(a);
                //};
                //console.log(fileText)
                //const reader = new FileReader();
                //const content = text();
                //console.log(text())
                return {
                    eventTimestamp: new Date(),
                    //fileData: event.clipboardData.files,
                    //fileData: event.clipboardData.getData('file'),
                    fileExtension: '.json',
                    //value: event.target.value
                    //value: event.target.files[0].text().then((str) => str)
                    value: text
                    //eventArgs: event.toString()
                };
            }
        });
    </script>
</body>

</html>
